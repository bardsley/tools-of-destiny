import{S as B,i as C,s as U,k as v,q as A,a as L,l as w,m as E,r as D,h,c as z,n as p,p as q,b as P,D as b,u as Y,I as O,j as ue,K as R,M as ae,g as X,d as j,H as V,N as fe,y as ne,z as re,A as oe,B as ie,L as ce,O as Z}from"../chunks/index.466a05aa.js";import{w as he}from"../chunks/index.f83cb8e3.js";import{O as de}from"../chunks/index.14018fbc.js";import{b as me,c as pe}from"../chunks/manifest.d6839a65.js";let W,M;console.log("Load creds from localstorage key:github value: {personalAuthToken:'XXXX'}"),W=localStorage.getItem("github")?JSON.parse(localStorage.getItem("github"))?.personalAuthToken:!1,W&&(M=new de({auth:W}));const ge=async(o,e,n,r,t)=>{if(typeof W>"u"||typeof M>"u")return console.error("Incorrect token",W,M),!1;if(!(o&&o.personalAuthToken&&o.repoName&&o.personalAuthToken))return console.error("Incorrect gitConfig",o),!1;let l={data:{content:""}},f=`${e}.txt`;try{l=await M.request("GET /repos/{owner}/{repo}/contents/{path}",{owner:o.owner,repo:o.repoName,path:f,headers:{}})}catch{console.log("File does not exist",f)}finally{console.log(l?.data)}let a=atob(l?.data?.content),i=new RegExp(`(//${n}start)([\\s\\S.]*?)(//${n}end)

`,"gm");a=a.replace(i,""),a=a.replace(/[\n\r]{3,}/gm,`

`);let d=a+`//${n}start
// ${r}
`+t+`
//${n}end

`,_={owner:"bardsley",repo:"wishwall",path:f,message:"Commit from the JSss",committer:{name:"perk-o-lator",email:"riven@destiny.tools"},content:btoa(d),headers:{}};l?.data?.sha&&(_={..._,sha:l?.data?.sha}),console.log(_);const g=await M.request("PUT /repos/{owner}/{repo}/contents/{path}",_);return console.log(g),g?.data?.content?.download_url};function x(o){let e,n,r,t,l,f,a;return{c(){e=v("button"),n=A("Copy to Clipboard"),r=L(),t=v("button"),l=A("Add To Git"),this.h()},l(i){e=w(i,"BUTTON",{class:!0});var d=E(e);n=D(d,"Copy to Clipboard"),d.forEach(h),r=z(i),t=w(i,"BUTTON",{class:!0});var _=E(t);l=D(_,"Add To Git"),_.forEach(h),this.h()},h(){p(e,"class","svelte-1gdozns"),p(t,"class","svelte-1gdozns")},m(i,d){P(i,e,d),b(e,n),P(i,r,d),P(i,t,d),b(t,l),f||(a=[R(e,"click",o[3]),R(e,"touch",o[3]),R(t,"click",o[4]),R(t,"touch",o[4])],f=!0)},p:O,d(i){i&&h(e),i&&h(r),i&&h(t),f=!1,ae(a)}}}function _e(o){let e,n,r=o[0].length+"",t,l,f,a,i,d,_,g,S,I,k=o[1]?.message+"",T,u,s=o[0].length>0&&x(o);return{c(){e=v("h3"),n=A("Generated "),t=A(r),l=A(` Perk Combos for DIM \r
    `),s&&s.c(),f=L(),a=v("textarea"),d=v("br"),_=L(),g=v("p"),S=v("a"),I=v("span"),T=A(k),this.h()},l(c){e=w(c,"H3",{class:!0});var m=E(e);n=D(m,"Generated "),t=D(m,r),l=D(m,` Perk Combos for DIM \r
    `),s&&s.l(m),m.forEach(h),f=z(c),a=w(c,"TEXTAREA",{id:!0,style:!0,class:!0}),E(a).forEach(h),d=w(c,"BR",{}),_=z(c),g=w(c,"P",{id:!0,class:!0});var N=E(g);S=w(N,"A",{href:!0,class:!0});var y=E(S);I=w(y,"SPAN",{class:!0});var G=E(I);T=D(G,k),G.forEach(h),y.forEach(h),N.forEach(h),this.h()},h(){p(e,"class","svelte-1gdozns"),p(a,"id","wish-wall"),q(a,"height",Math.min(o[2].length*1.125,20)+"em"),a.value=i=""+o[2].join(`
`)+`\r
`,p(a,"class","svelte-1gdozns"),p(I,"class","svelte-1gdozns"),p(S,"href",u=o[1]?.url),p(S,"class","svelte-1gdozns"),p(g,"id","status"),p(g,"class","svelte-1gdozns")},m(c,m){P(c,e,m),b(e,n),b(e,t),b(e,l),s&&s.m(e,null),P(c,f,m),P(c,a,m),P(c,d,m),P(c,_,m),P(c,g,m),b(g,S),b(S,I),b(I,T)},p(c,[m]){m&1&&r!==(r=c[0].length+"")&&Y(t,r),c[0].length>0?s?s.p(c,m):(s=x(c),s.c(),s.m(e,null)):s&&(s.d(1),s=null),m&4&&q(a,"height",Math.min(c[2].length*1.125,20)+"em"),m&4&&i!==(i=""+c[2].join(`
`)+`\r
`)&&(a.value=i),m&2&&k!==(k=c[1]?.message+"")&&Y(T,k),m&2&&u!==(u=c[1]?.url)&&p(S,"href",u)},i:O,o:O,d(c){c&&h(e),s&&s.d(),c&&h(f),c&&h(a),c&&h(d),c&&h(_),c&&h(g)}}}function $(o){return o.every(e=>e<1)}function ve(o,e,n){let r,{selectedPerks:t=[]}=e,{itemID:l=0}=e,{itemName:f=""}=e,{wishes:a=[]}=e,i=new Array(t.length).fill(0),d={message:"",url:""},_=[],g=(u,s)=>`dimwishlist:item=${u}&perks=${t[0][s[0]]},${t[1][s[1]]},${t[2][s[2]]},${t[3][s[3]]}`,S=()=>{let u=document.getElementById("wish-wall");u.select(),u.setSelectionRange(0,99999),navigator.clipboard.writeText(u.value)};ue(()=>{if(console.log(`Updated Wishlist
----------------`),T("Start"),r)console.log("Not enough options");else{for(n(0,a=[]),t.forEach((u,s)=>{i[s]=u.length-1});!$(i)&&k<100;)n(0,a=[...a,g(l,i)]),i[0]>0?i[0]-=1:(i[0]=t[0].length-1,i[1]>0?i[1]-=1:(i[1]=t[1].length-1,i[2]>0?i[2]-=1:(i[2]=t[2].length-1,i[3]>0?i[3]-=1:i[3]=t[3].length-1))),k+=1;T("Last Wish"),n(0,a=[...a,g(l,i)]),n(2,_=[`// ${f}`,"// - perks from perk-o-lator https://destiny.tools/perk-o-lator",...a])}k=0});let I=u=>{let s=localStorage.getItem("github");s&&(s=JSON.parse(s)),a.length>0&&s&&s.personalAuthToken&&s.repoName&&s.owner&&s.fileName&&s.personalAuthToken&&ge(s,s.fileName,l,f,a.join(`
`)).then(m=>{n(1,d={message:"Saved to "+m,url:m})},m=>{n(1,d={message:"Failed"})})},k=0,T=u=>{console.debug("----",u,"----",`
Done?`,$(i),`
Indices`,i,"Perks",t)};return o.$$set=u=>{"selectedPerks"in u&&n(5,t=u.selectedPerks),"itemID"in u&&n(6,l=u.itemID),"itemName"in u&&n(7,f=u.itemName),"wishes"in u&&n(0,a=u.wishes)},o.$$.update=()=>{o.$$.dirty&32&&t.forEach((u,s)=>{i[s]=u.length-1}),o.$$.dirty&32&&(r=t.some(u=>u.length<1))},[a,d,_,S,I,t,l,f]}class we extends B{constructor(e){super(),C(this,e,ve,_e,U,{selectedPerks:5,itemID:6,itemName:7,wishes:0})}}function ke(o){let e,n,r,t;return{c(){e=v("span"),n=A("Loading"),r=L(),t=v("small"),this.h()},l(l){e=w(l,"SPAN",{id:!0});var f=E(e);n=D(f,"Loading"),f.forEach(h),r=z(l),t=w(l,"SMALL",{});var a=E(t);a.forEach(h),this.h()},h(){p(e,"id","loader")},m(l,f){P(l,e,f),b(e,n),P(l,r,f),P(l,t,f)},p:O,i:O,o:O,d(l){l&&h(e),l&&h(r),l&&h(t)}}}class be extends B{constructor(e){super(),C(this,e,null,ke,U,{})}}function ee(o,e,n){const r=o.slice();return r[13]=e[n],r[15]=n,r}function te(o,e,n){const r=o.slice();return r[16]=e[n],r}function Ee(o){let e,n;return e=new be({}),{c(){ne(e.$$.fragment)},l(r){re(e.$$.fragment,r)},m(r,t){oe(e,r,t),n=!0},p:O,i(r){n||(X(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){ie(e,r)}}}function ye(o){let e,n,r,t,l,f,a,i,d,_,g,S,I,k,T,u=o[4],s=[];for(let c=0;c<u.length;c+=1)s[c]=le(ee(o,u,c));return k=new we({props:{selectedPerks:o[0],itemID:o[2],itemName:o[3]}}),{c(){e=v("header"),n=v("h1"),r=A(o[3]),t=L(),l=v("p"),f=v("a"),a=A("Light.GG"),i=L(),d=v("div"),_=v("div"),g=v("div");for(let c=0;c<s.length;c+=1)s[c].c();S=L(),I=v("div"),ne(k.$$.fragment),this.h()},l(c){e=w(c,"HEADER",{class:!0});var m=E(e);n=w(m,"H1",{class:!0});var N=E(n);r=D(N,o[3]),N.forEach(h),t=z(m),l=w(m,"P",{class:!0});var y=E(l);f=w(y,"A",{href:!0,target:!0,class:!0});var G=E(f);a=D(G,"Light.GG"),G.forEach(h),y.forEach(h),m.forEach(h),i=z(c),d=w(c,"DIV",{class:!0});var F=E(d);_=w(F,"DIV",{class:!0});var J=E(_);g=w(J,"DIV",{class:!0});var K=E(g);for(let H=0;H<s.length;H+=1)s[H].l(K);K.forEach(h),J.forEach(h),S=z(F),I=w(F,"DIV",{class:!0});var Q=E(I);re(k.$$.fragment,Q),Q.forEach(h),F.forEach(h),this.h()},h(){p(n,"class","svelte-fc7gww"),p(f,"href","https://www.light.gg/db/items/"+o[2]),p(f,"target","_blank"),p(f,"class","svelte-fc7gww"),p(l,"class","svelte-fc7gww"),p(e,"class","svelte-fc7gww"),p(g,"class","perks svelte-fc7gww"),p(_,"class","selector"),p(I,"class","cut-n-paste"),p(d,"class","columns svelte-fc7gww")},m(c,m){P(c,e,m),b(e,n),b(n,r),b(e,t),b(e,l),b(l,f),b(f,a),P(c,i,m),P(c,d,m),b(d,_),b(_,g);for(let N=0;N<s.length;N+=1)s[N]&&s[N].m(g,null);b(d,S),b(d,I),oe(k,I,null),T=!0},p(c,m){if(m&48){u=c[4];let y;for(y=0;y<u.length;y+=1){const G=ee(c,u,y);s[y]?s[y].p(G,m):(s[y]=le(G),s[y].c(),s[y].m(g,null))}for(;y<s.length;y+=1)s[y].d(1);s.length=u.length}const N={};m&1&&(N.selectedPerks=c[0]),k.$set(N)},i(c){T||(X(k.$$.fragment,c),T=!0)},o(c){j(k.$$.fragment,c),T=!1},d(c){c&&h(e),c&&h(i),c&&h(d),ce(s,c),ie(k)}}}function se(o){let e,n,r;return{c(){e=v("a"),this.h()},l(t){e=w(t,"A",{"data-perkid":!0,"data-colid":!0,class:!0,style:!0});var l=E(e);l.forEach(h),this.h()},h(){p(e,"data-perkid",o[16].id),p(e,"data-colid",o[15]),p(e,"class","perk "+o[16].enhanced+" svelte-fc7gww"),q(e,"background-image","url('https://www.bungie.net"+o[16].icon+"')")},m(t,l){P(t,e,l),n||(r=[R(e,"click",Z(o[5])),R(e,"touch",Z(o[5]))],n=!0)},p:O,d(t){t&&h(e),n=!1,ae(r)}}}function le(o){let e,n,r=o[13],t=[];for(let l=0;l<r.length;l+=1)t[l]=se(te(o,r,l));return{c(){e=v("div");for(let l=0;l<t.length;l+=1)t[l].c();n=L(),this.h()},l(l){e=w(l,"DIV",{class:!0});var f=E(e);for(let a=0;a<t.length;a+=1)t[a].l(f);n=z(f),f.forEach(h),this.h()},h(){p(e,"class","perkCol")},m(l,f){P(l,e,f);for(let a=0;a<t.length;a+=1)t[a]&&t[a].m(e,null);b(e,n)},p(l,f){if(f&48){r=l[13];let a;for(a=0;a<r.length;a+=1){const i=te(l,r,a);t[a]?t[a].p(i,f):(t[a]=se(i),t[a].c(),t[a].m(e,n))}for(;a<t.length;a+=1)t[a].d(1);t.length=r.length}},d(l){l&&h(e),ce(t,l)}}}function Pe(o){let e,n,r,t;const l=[ye,Ee],f=[];function a(i,d){return i[3]?0:1}return n=a(o),r=f[n]=l[n](o),{c(){e=v("div"),r.c(),this.h()},l(i){e=w(i,"DIV",{class:!0});var d=E(e);r.l(d),d.forEach(h),this.h()},h(){p(e,"class","item svelte-fc7gww")},m(i,d){P(i,e,d),f[n].m(e,null),t=!0},p(i,[d]){r.p(i,d)},i(i){t||(X(r),t=!0)},o(i){j(r),t=!1},d(i){i&&h(e),f[n].d()}}}function Ie(o,e,n){let r,t,l;V(o,me,u=>n(7,t=u)),V(o,pe,u=>n(8,l=u));let{data:f}=e;const a=he([[],[],[],[]]);V(o,a,u=>n(0,r=u));const i=f.itemID,d=t[i]?.displayProperties?.name,g=[1,2,3,4].map(u=>t[i]?.sockets.socketEntries[u].randomizedPlugSetHash).filter(u=>u>0).map(u=>l[u].reusablePlugItems.map(s=>s.plugItemHash)),S=new RegExp("Enhanced"),I=g.map(function(u){return u.map(function(s){return{id:s,name:t[s]?.displayProperties?.name,icon:t[s]?.displayProperties?.iconSequences[1]?.frames[0],enhanced:t[s]?.itemTypeDisplayName.match(S)?"enhanced":"basic"}})}),k=(u,s)=>u.includes(s)?u.filter(c=>c!=s):[...u,s];function T(u){u.target.dataset.perkid;let s=u.target.dataset.colid;u.target.classList.toggle("selected"),fe(a,r[s]=k(r[s],u.target.dataset.perkid),r)}return o.$$set=u=>{"data"in u&&n(6,f=u.data)},[r,a,i,d,I,T,f]}class De extends B{constructor(e){super(),C(this,e,Ie,Pe,U,{data:6})}}export{De as default};
