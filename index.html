<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/1ec65a0be2.js" crossorigin="anonymous"></script>

    <title>Tools of Destiny</title>
    <link rel="stylesheet" href="css/main.css" id>

    <script>
        var apps = [
        {   "name": "Braytech",                 "url": "https://bray.tech",
            "description": "", "tags": [ "maps","bounties","quests","vendors","triumphs","collections","weeklies","stats","lore","trivia" ]
        },{ "name": "Destiny recipes",          "url": "https://destinyrecipes.com",
            "description": "","tags":  [ "item-mgt","vault","weeklies","weapons","armor","godrolls","power-lvl","prep" ]
        },{ "name": "DIM",                      "url": "https://app.destinyitemmanager.com",
            "description": "", "tags": [ "item-mgt","vault","loadouts","weapons","armor","godrolls","power-lvl"]
        },{ "name": "D2 Checklist",             "url": "https://www.d2checklist.com",
            "description": "", "tags": [ "bounties","quests","vendors","triumphs","collections","weeklies","power-lvl","prep" ]
        },{ "name": "Shattered Vault",          "url": "https://shatteredvault.com",
            "description": "", "tags": [ "guides","lore","weeklies" ]
        },{ "name": "Xur",                      "url": "https://wherexur.com",
            "description": "", "tags": [ "vendors","weapons","armor","stats" ]
        },{ "name": "Light.gg",                         "url": "https://www.light.gg",
            "description": "", "tags": [ "item-mgt","vault","weapons","armor","godrolls"]
        },{ "name": "Destiny tracker",                         "url": "https://destinytracker.com",
            "description": "", "tags": [ "stats","pvp","pve","trivia"]
        },{ "name": "D2 Gunsmith",                         "url": "https://d2gunsmith.com",
            "description": "", "tags": [ "weapons","godrolls" ]
        },{ "name": "Destiny Sets",             "url": "https://destinysets.com/",
            "description": "", "tags": [ "weapons","armor","stats","trivia" ]
        },{ "name": "Guardian Forge",           "url": "https://guardianforge.net/",
            "description": "", "tags": [ "loadouts","weapons","armor" ]
        },{ "name": "Trials Report",            "url": "https://trials.report/",
            "description": "", "tags": [ "stats","pvp" ]
        },{ "name": "Guardian Report",          "url": "https://guardian.report/",
            "description": "", "tags": [ "stats","pve", "trivia" ]
        },{ "name": "Raid Report",              "url": "https://raid.report/",
            "description": "", "tags": ["stats","raid" ]
        },{ "name": "Wasted on Destiny",        "url": "https://wastedondestiny.com/",
            "description": "", "tags": [ "stats","trivia"]
        },{ "name": "Where is Xur?",            "url": "https://whereisxur.com/",
            "description": "", "tags": [ "vendors","weapons","armor" ]
        },{ "name": "Destiny Heat Map",         "url": "https://chrisfried.github.io/secret-scrublandeux/",
            "description": "", "tags": [ "trivia", "stats" ]
        },{ "name": "Guardian Theatre",         "url": "https://alpha.guardian.theater/",
            "description": "", "tags": [ "trivia" ]
        },{ "name": "Destiny Emblem Collector", "url": "https://destinyemblemcollector.com/",
            "description": "", "tags": [ "collections" ]
        },{ "name": "Today in Destiny",         "url": "https://www.todayindestiny.com/",
            "description": "", "tags": [ "bounties","quests","vendors","collections","weeklies" ]
        },{ "name": "Previously on Destiny",    "url": "https://www.previouslyondestiny.com/",
            "description": "", "tags": [ "lore" ]
        },{ "name": "Destiny K/D",              "url": "https://www.destinykd.com/",
            "description": "", "tags": [ "trivia","pvp","trials"]
        },{ "name": "Blueberries.gg",                         "url": "https://www.blueberries.gg/",
            "description": "", "tags": [ "guides", "weapons", "armor" ]
        },{ "name": "D2 Armor Picker",                         "url": "https://d2armorpicker.com/#/",
            "description": "", "tags": [ "loadouts", "armor" ]
        },{ "name": "Nightfall Report",                         "url": "https://nightfall.report",
            "description": "", "tags": [ "stats","pve" ]
        },{ "name": "",                         "url": "",
            "description": "", "tags": [ ]
        },{ "name": "",                         "url": "",
            "description": "", "tags": [ ]
        },{ "name": "",                         "url": "",
            "description": "", "tags": [ ]
        },{ "name": "",                         "url": "",
            "description": "", "tags": [ ]
        },{ "name": "",                         "url": "",
            "description": "", "tags": [ ]
        },{ "name": "",                         "url": "",
            "description": "", "tags": [ ]
        },{ "name": "",                         "url": "",
            "description": "", "tags": [ ]
        },{ "name": "",                         "url": "",
            "description": "", "tags": [ ]
        },{ "name": "",                         "url": "",
            "description": "", "tags": [ ]
        }  
    ];
    apps.sort((a,b) => { 
        return a.name.localeCompare(b.name) 
    })

    var tagCloud =  {}
    apps.forEach(app=>{
        app.tags.forEach(tag=>{
            tagCloud[tag] = tagCloud[tag] ?  tagCloud[tag] +1 : 1
        })
    })
    var tags = Object.keys(tagCloud)
    tags.unshift('all')

    var element = document.createElement('style'), sheet;
    document.head.appendChild(element);
    sheet = element.sheet;
    tags.forEach((tag,index)=>{
        var cardStyle = `main.${tag} #apps .card.${tag} { display:flex; } `;
        var tagStyle  = `main.${tag} #apps .tags .tag.${tag} { background: #05A895; } `
        sheet.insertRule(cardStyle,index);
        sheet.insertRule(tagStyle,index);
    })
    
    var graphics = [
        { "name": "GM Champs Basic", "url": "images/champs-basic.png" },
        { "name": "GM Champs Detailed", "url": "images/champs-gmnf.png" },
        { "name": "Vow - 1st Encounter", "url": "images/vow-1.png" },
        { "name": "Vow - 3rd Encounter", "url": "images/vow-3.jpg" },
        { "name": "Vow - Final Encounter", "url": "images/vow-4.jpg" },
        { "name": "Vow - Symbols", "url": "images/vow-symbols.webp" },
    ]

    document.addEventListener('DOMContentLoaded',event => {

        var controlSpace = document.getElementById('controls')
        var mainSpace = document.querySelector('main')
        var appSpace = document.getElementById('apps')
        var appTemplate = document.getElementById('app-card');
        var graphicSpace = document.getElementById('graphics')
        var graphicTemplate = document.getElementById('graphic-card');

        tags.forEach(tag=>{
            var control = document.createElement('a')
            control.href = "javascript:void(0);"
            control.className = `tag ${tag}`
            control.innerText = tag
            control.dataset.tag = tag
            controlSpace.append(control)
        })

        
        apps.forEach(app => {
            if(app.name && app.url) {
                var clone = appTemplate.content.firstElementChild.cloneNode(true);
                clone.className = clone.className + " " + app.tags.join(' ')
                clone.querySelector(".title").innerText = app.name
                if(app.description) { clone.querySelector(".desc").innerText = app.description } else { clone.querySelector(".desc").remove() }
                if(app.tags && app.tags.length >0) { 
                    clone.querySelector(".tags").innerHTML = app.tags.map(tag=>{ return `<span data-tag="${tag}" class="tag ${tag}">${tag}</span>` }).join(' ') 
                } else { clone.querySelector(".tags").remove() }
                clone.querySelector(".button").href = app.url
                appSpace.append(clone);
            }
            
        });
        mainSpace.className = tags.join(' ')
       
        Array.from(document.querySelectorAll('.tag')).forEach(elm=>{
            elm.addEventListener('click',(event)=>{
                var tag = event.currentTarget.dataset.tag
                if(tag !== 'all') {
                    mainSpace.classList.toggle(tag)
                } else {
                    mainSpace.className = tags.join(' ') 
                }
            })
            elm.addEventListener('dblclick',(event)=>{
                mainSpace.className = event.currentTarget.dataset.tag
            })
        })

        // Graphics Switcher
        graphics.forEach(img => {
            var clone = graphicTemplate.content.firstElementChild.cloneNode(true);
            clone.querySelector(".title").innerText = img.name
            clone.querySelector(".button").innerText = img.name
            clone.querySelector(".button").dataset.image = img.url
            graphicSpace.append(clone);   
        });
        var graphicChanger = document.createElement('img')
        graphicSpace.append(graphicChanger)
        graphicChanger.id = "selected-graphic";

        Array.from(document.querySelectorAll('.graphic-button a')).forEach(elm => {
            elm.addEventListener('click',event => {
                graphicChanger.src = event.currentTarget.dataset.image
            })
        })
        
    })
    
    </script>
</head>
<body>
    
    <header>Tools of destiny - by <span id="bungie-name">Abards_ìœ <span id="bungie-id">#4283</span></span></header>

    <main>
        <div id="controls"></div>
        <div id="apps"><h2>Apps</h2></div>
        <div id="graphics">
            <h2>InfoGraphics</h2>

            <!-- <img src="https://i.imgur.com/MhP4MyC.png" alt="Nightfalls">
            <img src="https://media.discordapp.net/attachments/874687605319561216/942764420520640552/gmnf.png" alt="Nightfalls 2">
            <img src="https://pbs.twimg.com/media/FNkh8deXIAIg2ze?format=jpg&name=large" alt="">
            <img src="https://pbs.twimg.com/media/FNbMUXsWQAQvxWA?format=jpg&name=large" alt="">
            <img src="https://i.postimg.cc/43Ygk2Z6/Vot-D-Encounter-1-V6.png" alt="">
            <img src="https://d1lss44hh2trtw.cloudfront.net/resize?type=webp&url=https%3A%2F%2Fshacknews-www.s3.amazonaws.com%2Fassets%2Feditorial%2F2022%2F03%2Fdestiny-2-vow-of-the-disciple-raid-symbols-v2.jpg&width=986&sign=ojZqyODcdWDxxd9KGJhn91hLfNah5oCV7fu2UaKWbss" alt=""> -->
        </div>
    </main>

    <template id="app-card">
        <div class="card">
            <a href="" class="button title">{{Name}}</a>
            <div class="tags"></div>
            <p class="desc"></p>
        </div>
    </template>
    
    <template id="graphic-card">
        <div class="card graphic-button">
            <a href="javascript:void(0);" class="button title">{{Name}}</a>
        </div>
    </template>
    
</body>
</html>

